<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Dubai Incentive Tracker 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --navy: #1a2a4a;
            --gold: #d4af37;
            --light-gold: #f4e4ba;
            --teal: #008080;
            --white: #ffffff;
            --light-bg: #f5f7fa;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a2a4a 0%, #2d4a6d 50%, #1a2a4a 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, var(--navy), #2d4a6d);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border: 3px solid var(--gold);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(212,175,55,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .header h1 {
            color: var(--gold);
            font-size: 2.5em;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: var(--white);
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .header .trip-dates {
            background: var(--gold);
            color: var(--navy);
            padding: 10px 30px;
            border-radius: 50px;
            display: inline-block;
            font-weight: 700;
            font-size: 1.1em;
        }

        .target-badge {
            background: linear-gradient(135deg, var(--teal), #00a0a0);
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            margin-top: 20px;
            display: inline-block;
            font-size: 1.3em;
            font-weight: 600;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 15px 30px;
            background: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Poppins', sans-serif;
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .tab-btn.active {
            background: var(--gold);
            color: var(--navy);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, var(--navy), #2d4a6d);
            color: var(--gold);
            padding: 20px;
            font-size: 1.3em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-header.teal {
            background: linear-gradient(135deg, var(--teal), #00a0a0);
            color: white;
        }

        .card-header.gold {
            background: linear-gradient(135deg, var(--gold), #e5c54d);
            color: var(--navy);
        }

        .card-body {
            padding: 25px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--navy);
            font-size: 0.95em;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 4px rgba(212,175,55,0.2);
        }

        .value-display {
            background: linear-gradient(135deg, var(--light-gold), #fff8e7);
            border: 2px solid var(--gold);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .value-display .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .value-display .amount {
            font-size: 1.8em;
            font-weight: 800;
            color: var(--navy);
        }

        .stock-info {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border: 2px solid var(--success);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 15px;
        }

        .stock-info.low {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border-color: var(--danger);
        }

        .stock-info.medium {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border-color: var(--warning);
        }

        .stock-info .label {
            font-size: 0.85em;
            color: #666;
        }

        .stock-info .value {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--navy);
        }

        .btn-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--gold), #e5c54d);
            color: var(--navy);
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(212,175,55,0.4);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Leaderboard */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th {
            background: var(--navy);
            color: var(--gold);
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9em;
        }

        .leaderboard-table td {
            padding: 15px 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 0.95em;
        }

        .leaderboard-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .leaderboard-table tr:hover {
            background: var(--light-gold);
        }

        .rank-1 { background: linear-gradient(135deg, #ffd700, #ffec8b) !important; }
        .rank-2 { background: linear-gradient(135deg, #c0c0c0, #e8e8e8) !important; }
        .rank-3 { background: linear-gradient(135deg, #cd7f32, #daa06d) !important; }

        .rank-badge {
            font-size: 1.5em;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .status-qualified {
            background: var(--success);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-pending {
            background: var(--warning);
            color: var(--navy);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        /* Inventory Table */
        .inventory-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            font-family: 'Poppins', sans-serif;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--gold);
        }

        .filter-btn {
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .filter-btn:hover, .filter-btn.active {
            border-color: var(--gold);
            background: var(--light-gold);
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        .inventory-table th {
            background: var(--teal);
            color: white;
            padding: 14px 10px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            cursor: pointer;
        }

        .inventory-table th:hover {
            background: #006666;
        }

        .inventory-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
        }

        .inventory-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .inventory-table tr:hover {
            background: var(--light-gold);
        }

        .stock-high {
            background: #c8e6c9;
            color: #2e7d32;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.85em;
        }

        .stock-medium {
            background: #fff3cd;
            color: #856404;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.85em;
        }

        .stock-low {
            background: #f8d7da;
            color: #721c24;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.85em;
        }

        .stock-out {
            background: #dc3545;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.85em;
        }

        .inventory-wrapper {
            max-height: 600px;
            overflow-y: auto;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }

        /* Records Table */
        .records-section {
            margin-top: 30px;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        .records-table th {
            background: var(--navy);
            color: var(--gold);
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
        }

        .records-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
        }

        .records-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 30px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .toast-success { background: var(--success); }
        .toast-error { background: var(--danger); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1000px) {
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 600px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .stat-card .icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 1.6em;
            font-weight: 800;
            color: var(--navy);
        }

        .stat-card .label {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--light-gold);
            margin-top: 30px;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5em;
            }
            .header .subtitle {
                font-size: 1em;
            }
            .target-badge {
                font-size: 1em;
                padding: 10px 20px;
            }
            .stat-card .value {
                font-size: 1.3em;
            }
            .tab-btn {
                padding: 12px 20px;
                font-size: 0.9em;
            }
        }

        /* Summary boxes */
        .inventory-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 800px) {
            .inventory-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .summary-box {
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .summary-box.total {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 2px solid #2196f3;
        }

        .summary-box.high {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border: 2px solid var(--success);
        }

        .summary-box.medium {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border: 2px solid var(--warning);
        }

        .summary-box.low {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border: 2px solid var(--danger);
        }

        .summary-box .num {
            font-size: 1.8em;
            font-weight: 800;
            color: var(--navy);
        }

        .summary-box .txt {
            font-size: 0.85em;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>‚úàÔ∏è DUBAI TRIP INCENTIVE 2025 üèÜ</h1>
            <p class="subtitle">Purchase Team Sales Tracker</p>
            <div class="trip-dates">
                <i class="fas fa-calendar-alt"></i> 9th - 12th February 2025
            </div>
            <div class="target-badge">
                üéØ TARGET: ‚Çπ12,00,000 Per Member
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="icon">üë•</div>
                <div class="value" id="totalMembers">10</div>
                <div class="label">Team Members</div>
            </div>
            <div class="stat-card">
                <div class="icon">‚úÖ</div>
                <div class="value" id="qualifiedCount">0</div>
                <div class="label">Qualified</div>
            </div>
            <div class="stat-card">
                <div class="icon">üí∞</div>
                <div class="value" id="totalSales">‚Çπ0</div>
                <div class="label">Total Sales</div>
            </div>
            <div class="stat-card">
                <div class="icon">üì¶</div>
                <div class="value" id="totalProducts">53</div>
                <div class="label">Products</div>
            </div>
            <div class="stat-card">
                <div class="icon">üìä</div>
                <div class="value" id="totalEntries">0</div>
                <div class="label">Entries</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('sales')">
                <i class="fas fa-plus-circle"></i> Add Sale
            </button>
            <button class="tab-btn" onclick="showTab('inventory')">
                <i class="fas fa-boxes"></i> Inventory Status
            </button>
            <button class="tab-btn" onclick="showTab('leaderboard')">
                <i class="fas fa-trophy"></i> Leaderboard
            </button>
            <button class="tab-btn" onclick="showTab('records')">
                <i class="fas fa-list"></i> All Records
            </button>
        </div>

        <!-- Tab 1: Sales Entry -->
        <div id="salesTab" class="tab-content active">
            <div class="main-grid">
                <!-- Entry Form -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-plus-circle"></i> Add Sales Entry
                    </div>
                    <div class="card-body">
                        <form id="salesForm">
                            <div class="form-group">
                                <label><i class="fas fa-user"></i> Team Member</label>
                                <select id="memberName" required>
                                    <option value="">-- Select Your Name --</option>
                                    <option value="GAURI">GAURI</option>
                                    <option value="SURAJ">SURAJ</option>
                                    <option value="ROHAN">ROHAN</option>
                                    <option value="JITIN">JITIN</option>
                                    <option value="POOJA">POOJA</option>
                                    <option value="PANKAJ">PANKAJ</option>
                                    <option value="DIPALI">DIPALI</option>
                                    <option value="ASHWINI">ASHWINI</option>
                                    <option value="NISHA">NISHA</option>
                                    <option value="SUMANTH">SUMANTH</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-calendar"></i> Date</label>
                                <input type="date" id="saleDate" required>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-box"></i> Product</label>
                                <select id="productName" required>
                                    <option value="">-- Select Product --</option>
                                </select>
                            </div>

                            <div id="stockInfoBox" class="stock-info" style="display:none;">
                                <div class="label">Available Stock</div>
                                <div class="value" id="availableStock">-</div>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-sort-numeric-up"></i> Quantity Sold</label>
                                <input type="number" id="qtySold" min="1" placeholder="Enter quantity" required>
                                <small id="qtyWarning" style="color: var(--danger); display: none;">‚ö†Ô∏è Quantity exceeds available stock!</small>
                            </div>

                            <div class="form-group">
                                <div class="value-display">
                                    <div class="label">Calculated Value</div>
                                    <div class="amount" id="calculatedValue">‚Çπ0.00</div>
                                </div>
                            </div>

                            <button type="submit" class="btn-submit" id="submitBtn">
                                <i class="fas fa-paper-plane"></i> SUBMIT SALE
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Quick Leaderboard -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-trophy"></i> Live Leaderboard
                    </div>
                    <div class="card-body" id="quickLeaderboard">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading leaderboard...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 2: Inventory -->
        <div id="inventoryTab" class="tab-content">
            <div class="card">
                <div class="card-header teal">
                    <i class="fas fa-boxes"></i> Inventory Status - Real-time Stock Availability
                </div>
                <div class="card-body">
                    <!-- Summary Boxes -->
                    <div class="inventory-summary">
                        <div class="summary-box total">
                            <div class="num" id="invTotal">53</div>
                            <div class="txt">Total Products</div>
                        </div>
                        <div class="summary-box high">
                            <div class="num" id="invHigh">0</div>
                            <div class="txt">‚úÖ High Stock</div>
                        </div>
                        <div class="summary-box medium">
                            <div class="num" id="invMedium">0</div>
                            <div class="txt">üü° Medium Stock</div>
                        </div>
                        <div class="summary-box low">
                            <div class="num" id="invLow">0</div>
                            <div class="txt">üî¥ Low/Out of Stock</div>
                        </div>
                    </div>

                    <!-- Search & Filters -->
                    <div class="inventory-controls">
                        <input type="text" class="search-box" id="inventorySearch" placeholder="üîç Search product...">
                        <button class="filter-btn active" onclick="filterInventory('all')">All</button>
                        <button class="filter-btn" onclick="filterInventory('high')">‚úÖ High</button>
                        <button class="filter-btn" onclick="filterInventory('medium')">üü° Medium</button>
                        <button class="filter-btn" onclick="filterInventory('low')">üî¥ Low</button>
                    </div>

                    <!-- Inventory Table -->
                    <div class="inventory-wrapper">
                        <table class="inventory-table" id="inventoryTable">
                            <thead>
                                <tr>
                                    <th onclick="sortInventory('sno')">#</th>
                                    <th onclick="sortInventory('name')">Product Name ‚Üï</th>
                                    <th onclick="sortInventory('opening')">Opening Stock ‚Üï</th>
                                    <th onclick="sortInventory('sold')">Total Sold ‚Üï</th>
                                    <th onclick="sortInventory('available')">Available ‚Üï</th>
                                    <th onclick="sortInventory('price')">Unit Price ‚Üï</th>
                                    <th onclick="sortInventory('value')">Stock Value ‚Üï</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryBody">
                                <tr>
                                    <td colspan="8" class="loading">Loading inventory...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 3: Leaderboard -->
        <div id="leaderboardTab" class="tab-content">
            <div class="card">
                <div class="card-header gold">
                    <i class="fas fa-trophy"></i> Dubai Incentive Leaderboard
                </div>
                <div class="card-body" id="fullLeaderboard">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading leaderboard...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 4: All Records -->
        <div id="recordsTab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-list"></i> All Sales Records (Read-Only - Cannot Delete)
                </div>
                <div class="card-body" id="recordsContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading records...</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>üå¥ Work Hard, Fly to Dubai! üå¥</p>
            <p style="font-size: 0.8em; margin-top: 10px;">¬© 2025 Dubai Incentive Program</p>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION - UPDATE THIS WITH YOUR SCRIPT URL
        // ============================================
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby7v1XAOb8JZDdaWCsGGSEqNWqMJA9jli_O6DmpjkMe8hKuwSuD83gmZyTCBB5VrlPApQ/exec';
        
        // ============================================
        // PRODUCT DATA WITH PRICES AND OPENING STOCK
        // ============================================
        const products = [
            { sno: 1, name: "L-ASAP 10000 IU INJECTION", price: 491.44, openingStock: 3197 },
            { sno: 6, name: "OLVORIN 300 MG", price: 132.00, openingStock: 4244 },
            { sno: 8, name: "BIRAFINE 250MG", price: 2343.99, openingStock: 200 },
            { sno: 10, name: "OLVORIN 50MG", price: 23.02, openingStock: 16338 },
            { sno: 9, name: "BLEOCEL 15 IU", price: 430.00, openingStock: 874 },
            { sno: 4, name: "MEREVA 1GM INJ", price: 85.00, openingStock: 4377 },
            { sno: 7, name: "IVF HMG 150IU", price: 208.16, openingStock: 1520 },
            { sno: 13, name: "GELDAZ-200 MG", price: 108.01, openingStock: 2293 },
            { sno: 15, name: "TRETINOID CAPS", price: 450.00, openingStock: 543 },
            { sno: 21, name: "HALKERAN 2MG", price: 564.64, openingStock: 343 },
            { sno: 25, name: "BLEOSTED 15", price: 425.00, openingStock: 450 },
            { sno: 27, name: "BIORIN 500MG", price: 165.00, openingStock: 1082 },
            { sno: 17, name: "XARELTO 20 MG", price: 1409.14, openingStock: 117 },
            { sno: 28, name: "BETASONE 52", price: 5.61, openingStock: 28450 },
            { sno: 22, name: "DECA 200MG", price: 75.00, openingStock: 2120 },
            { sno: 24, name: "IPOSMA 2GM", price: 480.00, openingStock: 330 },
            { sno: 36, name: "EVERMIDE 10MG", price: 600.00, openingStock: 240 },
            { sno: 5, name: "IVF HCG 1500IU", price: 88.00, openingStock: 1530 },
            { sno: 31, name: "XVIN-C 1MG", price: 45.00, openingStock: 2950 },
            { sno: 32, name: "EVERMIDE 25MG", price: 1100.00, openingStock: 119 },
            { sno: 35, name: "OXYDROX 500MG CAP", price: 18.91, openingStock: 6830 },
            { sno: 30, name: "XARELTO 10MG", price: 652.11, openingStock: 198 },
            { sno: 14, name: "BIOSIDE 100MG", price: 73.00, openingStock: 1712 },
            { sno: 16, name: "KAMAGRA JELLY 5GM/VOL-1", price: 11.50, openingStock: 10500 },
            { sno: 34, name: "GEMCHEM -1000MG", price: 337.19, openingStock: 337 },
            { sno: 42, name: "VERQUVO 5 MG", price: 1224.62, openingStock: 74 },
            { sno: 47, name: "FAZOLIN 1G INJ", price: 43.00, openingStock: 2000 },
            { sno: 41, name: "FLURASTED 500 MG", price: 18.00, openingStock: 4690 },
            { sno: 40, name: "NAB-PACLITAX 100MG", price: 1150.00, openingStock: 72 },
            { sno: 52, name: "VERA NATIVIS Natural Radiance", price: 621.01, openingStock: 129 },
            { sno: 53, name: "OXPLATIN 50 MG", price: 185.71, openingStock: 428 },
            { sno: 48, name: "VIRQUVO 10 MG", price: 1224.62, openingStock: 64 },
            { sno: 60, name: "CELRIXAFOR-24MG INJ", price: 15714.00, openingStock: 4 },
            { sno: 65, name: "HODPRO 50MG", price: 241.45, openingStock: 230 },
            { sno: 69, name: "Oncovorin 50 Mg", price: 30.00, openingStock: 1210 },
            { sno: 61, name: "PSICLIB 125 MG", price: 3620.32, openingStock: 10 },
            { sno: 75, name: "ROCROSE FCM 10ML", price: 159.38, openingStock: 225 },
            { sno: 77, name: "INCEPTOVA-FSH 150IU", price: 1317.86, openingStock: 27 },
            { sno: 80, name: "G MP 50 MG", price: 35.79, openingStock: 980 },
            { sno: 71, name: "DBPARB 150MG", price: 1242.33, openingStock: 28 },
            { sno: 55, name: "IMATIB 400MG TAB", price: 405.00, openingStock: 85 },
            { sno: 85, name: "LENVATOL 10MG", price: 2423.08, openingStock: 13 },
            { sno: 88, name: "VALGAN 450 MG", price: 1501.11, openingStock: 20 },
            { sno: 63, name: "DENCIQ INJ 120MG", price: 15000.00, openingStock: 2 },
            { sno: 51, name: "OXEMIA 100MG", price: 996.87, openingStock: 28 },
            { sno: 59, name: "XARELTO 15 MG", price: 1399.88, openingStock: 19 },
            { sno: 76, name: "Totalflux Turmeric Mouthwash", price: 106.68, openingStock: 248 },
            { sno: 54, name: "KAMAGRA TAB 100MG", price: 26.00, openingStock: 1000 },
            { sno: 87, name: "Totalflux Mintfresh Mouthwash", price: 106.53, openingStock: 237 },
            { sno: 78, name: "PIMERPLAST 500MG INJ", price: 702.00, openingStock: 35 },
            { sno: 93, name: "DAUNEON 20 MG", price: 119.70, openingStock: 200 },
            { sno: 97, name: "HELPRIN INJ 25000IU", price: 78.00, openingStock: 288 },
            { sno: 33, name: "OXA-100MG INJ", price: 415.00, openingStock: 53 }
        ];

        const TARGET = 1200000;
        const teamMembers = ["GAURI", "SURAJ", "ROHAN", "JITIN", "POOJA", "PANKAJ", "DIPALI", "ASHWINI", "NISHA", "SUMANTH"];

        // Global data store
        let salesData = [];
        let productSales = {};
        let currentFilter = 'all';
        let currentSort = { column: 'name', order: 'asc' };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeForm();
            loadData();
        });

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.closest('.tab-btn').classList.add('active');
        }

        function initializeForm() {
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('saleDate').value = today;

            // Populate products dropdown
            const productSelect = document.getElementById('productName');
            const sortedProducts = [...products].sort((a, b) => a.name.localeCompare(b.name));
            sortedProducts.forEach(product => {
                const option = document.createElement('option');
                option.value = product.name;
                option.textContent = `${product.name} (‚Çπ${product.price.toFixed(2)})`;
                productSelect.appendChild(option);
            });

            // Event listeners
            document.getElementById('productName').addEventListener('change', onProductChange);
            document.getElementById('qtySold').addEventListener('input', calculateValue);
            document.getElementById('inventorySearch').addEventListener('input', filterInventoryBySearch);
        }

        function onProductChange() {
            const productName = document.getElementById('productName').value;
            const product = products.find(p => p.name === productName);
            const stockInfoBox = document.getElementById('stockInfoBox');
            
            if (product) {
                const sold = productSales[productName] || 0;
                const available = product.openingStock - sold;
                
                document.getElementById('availableStock').textContent = available.toLocaleString('en-IN');
                stockInfoBox.style.display = 'block';
                
                // Update stock info styling
                stockInfoBox.classList.remove('low', 'medium');
                if (available <= product.openingStock * 0.1) {
                    stockInfoBox.classList.add('low');
                } else if (available <= product.openingStock * 0.3) {
                    stockInfoBox.classList.add('medium');
                }
            } else {
                stockInfoBox.style.display = 'none';
            }
            
            calculateValue();
        }

        function calculateValue() {
            const productName = document.getElementById('productName').value;
            const qty = parseInt(document.getElementById('qtySold').value) || 0;
            const product = products.find(p => p.name === productName);
            const qtyWarning = document.getElementById('qtyWarning');
            
            if (product && qty > 0) {
                const value = product.price * qty;
                document.getElementById('calculatedValue').textContent = '‚Çπ' + value.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                
                // Check stock warning
                const sold = productSales[productName] || 0;
                const available = product.openingStock - sold;
                
                if (qty > available) {
                    qtyWarning.style.display = 'block';
                } else {
                    qtyWarning.style.display = 'none';
                }
            } else {
                document.getElementById('calculatedValue').textContent = '‚Çπ0.00';
                qtyWarning.style.display = 'none';
            }
        }

        // Form submission
        document.getElementById('salesForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';

            const productName = document.getElementById('productName').value;
            const product = products.find(p => p.name === productName);
            const qty = parseInt(document.getElementById('qtySold').value);
            const value = product.price * qty;

            const data = {
                action: 'addSale',
                timestamp: new Date().toISOString(),
                date: document.getElementById('saleDate').value,
                member: document.getElementById('memberName').value,
                product: productName,
                unitPrice: product.price,
                qty: qty,
                value: value
            };

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                showToast('‚úÖ Sale recorded successfully!', 'success');
                document.getElementById('salesForm').reset();
                document.getElementById('saleDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('calculatedValue').textContent = '‚Çπ0.00';
                document.getElementById('stockInfoBox').style.display = 'none';
                document.getElementById('qtyWarning').style.display = 'none';
                
                // Reload data after short delay
                setTimeout(loadData, 1500);

            } catch (error) {
                showToast('‚ùå Error submitting sale. Please try again.', 'error');
                console.error('Error:', error);
            }

            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> SUBMIT SALE';
        });

        // Load data from Google Sheets
        async function loadData() {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getData');
                const data = await response.json();
                
                salesData = data.records || [];
                calculateProductSales();
                
                updateLeaderboard(data.leaderboard || []);
                updateRecords(data.records || []);
                updateInventory();
                updateStats(data);

            } catch (error) {
                console.error('Error loading data:', error);
                showDemoData();
            }
        }

        function calculateProductSales() {
            productSales = {};
            salesData.forEach(record => {
                const product = record.product;
                const qty = parseInt(record.qty) || 0;
                productSales[product] = (productSales[product] || 0) + qty;
            });
        }

        function updateLeaderboard(leaderboard) {
            if (leaderboard.length === 0) {
                leaderboard = teamMembers.map(name => ({ name, total: 0 }));
            }

            leaderboard.sort((a, b) => b.total - a.total);

            const html = generateLeaderboardHTML(leaderboard);
            document.getElementById('quickLeaderboard').innerHTML = html;
            document.getElementById('fullLeaderboard').innerHTML = html;
        }

        function generateLeaderboardHTML(leaderboard) {
            let html = `
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Member</th>
                            <th>Achieved</th>
                            <th>Progress</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            leaderboard.forEach((member, index) => {
                const rank = index + 1;
                const percentage = Math.min((member.total / TARGET) * 100, 120);
                const displayPercentage = (member.total / TARGET) * 100;
                const isQualified = member.total >= TARGET;
                const rankClass = rank <= 3 ? `rank-${rank}` : '';
                const rankEmoji = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : rank;
                const progressColor = percentage >= 100 ? '#28a745' : percentage >= 70 ? '#ffc107' : '#dc3545';

                html += `
                    <tr class="${rankClass}">
                        <td><span class="rank-badge">${rankEmoji}</span></td>
                        <td><strong>${member.name}</strong></td>
                        <td>‚Çπ${member.total.toLocaleString('en-IN')}</td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%; background: ${progressColor};"></div>
                            </div>
                            <small>${displayPercentage.toFixed(1)}%</small>
                        </td>
                        <td>
                            <span class="${isQualified ? 'status-qualified' : 'status-pending'}">
                                ${isQualified ? '‚úÖ DUBAI!' : '‚è≥ Pending'}
                            </span>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            return html;
        }

        function updateRecords(records) {
            const container = document.getElementById('recordsContainer');
            
            if (records.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#666; padding: 40px;">No records yet. Start adding sales!</p>';
                return;
            }

            const latestRecords = records.slice(-100).reverse();

            let html = `
                <table class="records-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Date</th>
                            <th>Member</th>
                            <th>Product</th>
                            <th>Qty</th>
                            <th>Unit Price</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            latestRecords.forEach((record, index) => {
                html += `
                    <tr>
                        <td>${records.length - index}</td>
                        <td>${record.date}</td>
                        <td><strong>${record.member}</strong></td>
                        <td>${record.product}</td>
                        <td>${record.qty}</td>
                        <td>‚Çπ${parseFloat(record.unitPrice).toLocaleString('en-IN')}</td>
                        <td><strong>‚Çπ${parseFloat(record.value).toLocaleString('en-IN')}</strong></td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            if (records.length > 100) {
                html += `<p style="text-align:center; margin-top:15px; color:#666;">Showing latest 100 of ${records.length} records</p>`;
            }
            container.innerHTML = html;
        }

        function updateInventory() {
            const tbody = document.getElementById('inventoryBody');
            
            let inventoryData = products.map(product => {
                const sold = productSales[product.name] || 0;
                const available = product.openingStock - sold;
                const stockValue = available * product.price;
                
                let status, statusClass;
                if (available <= 0) {
                    status = 'OUT OF STOCK';
                    statusClass = 'stock-out';
                } else if (available <= product.openingStock * 0.1) {
                    status = 'LOW';
                    statusClass = 'stock-low';
                } else if (available <= product.openingStock * 0.3) {
                    status = 'MEDIUM';
                    statusClass = 'stock-medium';
                } else {
                    status = 'HIGH';
                    statusClass = 'stock-high';
                }

                return {
                    ...product,
                    sold,
                    available,
                    stockValue,
                    status,
                    statusClass
                };
            });

            // Apply filter
            if (currentFilter !== 'all') {
                inventoryData = inventoryData.filter(p => {
                    if (currentFilter === 'high') return p.status === 'HIGH';
                    if (currentFilter === 'medium') return p.status === 'MEDIUM';
                    if (currentFilter === 'low') return p.status === 'LOW' || p.status === 'OUT OF STOCK';
                    return true;
                });
            }

            // Apply search
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
            if (searchTerm) {
                inventoryData = inventoryData.filter(p => p.name.toLowerCase().includes(searchTerm));
            }

            // Apply sort
            inventoryData.sort((a, b) => {
                let aVal, bVal;
                switch(currentSort.column) {
                    case 'name': aVal = a.name; bVal = b.name; break;
                    case 'opening': aVal = a.openingStock; bVal = b.openingStock; break;
                    case 'sold': aVal = a.sold; bVal = b.sold; break;
                    case 'available': aVal = a.available; bVal = b.available; break;
                    case 'price': aVal = a.price; bVal = b.price; break;
                    case 'value': aVal = a.stockValue; bVal = b.stockValue; break;
                    default: aVal = a.sno; bVal = b.sno;
                }
                
                if (typeof aVal === 'string') {
                    return currentSort.order === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
                }
                return currentSort.order === 'asc' ? aVal - bVal : bVal - aVal;
            });

            // Generate HTML
            let html = '';
            inventoryData.forEach((product, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${product.name}</strong></td>
                        <td>${product.openingStock.toLocaleString('en-IN')}</td>
                        <td>${product.sold.toLocaleString('en-IN')}</td>
                        <td><strong>${product.available.toLocaleString('en-IN')}</strong></td>
                        <td>‚Çπ${product.price.toLocaleString('en-IN', {minimumFractionDigits: 2})}</td>
                        <td>‚Çπ${product.stockValue.toLocaleString('en-IN', {minimumFractionDigits: 2})}</td>
                        <td><span class="${product.statusClass}">${product.status}</span></td>
                    </tr>
                `;
            });

            tbody.innerHTML = html || '<tr><td colspan="8" style="text-align:center; padding:20px;">No products found</td></tr>';

            // Update summary
            const allInventory = products.map(p => {
                const sold = productSales[p.name] || 0;
                const available = p.openingStock - sold;
                if (available <= 0) return 'out';
                if (available <= p.openingStock * 0.1) return 'low';
                if (available <= p.openingStock * 0.3) return 'medium';
                return 'high';
            });

            document.getElementById('invTotal').textContent = products.length;
            document.getElementById('invHigh').textContent = allInventory.filter(s => s === 'high').length;
            document.getElementById('invMedium').textContent = allInventory.filter(s => s === 'medium').length;
            document.getElementById('invLow').textContent = allInventory.filter(s => s === 'low' || s === 'out').length;
        }

        function filterInventory(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateInventory();
        }

        function filterInventoryBySearch() {
            updateInventory();
        }

        function sortInventory(column) {
            if (currentSort.column === column) {
                currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.order = 'asc';
            }
            updateInventory();
        }

        function updateStats(data) {
            const leaderboard = data.leaderboard || [];
            const qualified = leaderboard.filter(m => m.total >= TARGET).length;
            const totalSales = leaderboard.reduce((sum, m) => sum + m.total, 0);
            
            document.getElementById('qualifiedCount').textContent = qualified;
            document.getElementById('totalSales').textContent = '‚Çπ' + (totalSales / 100000).toFixed(1) + 'L';
            document.getElementById('totalEntries').textContent = (data.records || []).length;
        }

        function showDemoData() {
            const demoLeaderboard = teamMembers.map(name => ({
                name: name,
                total: 0
            }));
            updateLeaderboard(demoLeaderboard);
            updateInventory();
            document.getElementById('recordsContainer').innerHTML = '<p style="text-align:center; color:#666; padding:40px;">‚ö†Ô∏è Connect Google Sheet to see records.<br><small>Update GOOGLE_SCRIPT_URL in the code.</small></p>';
        }

        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3500);
        }
    </script>
</body>
</html>
